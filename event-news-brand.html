<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        /* HEADER */
        header {
            background: linear-gradient(to right, #764ba2, #667eea);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* TABS */
        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab {
            padding: 20px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #64748b;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
        }
        
        .tab:hover {
            color: #764ba2;
        }
        
        .tab.active {
            color: #764ba2;
            border-bottom: 3px solid #764ba2;
            background: white;
        }
        
        /* CONTENT AREAS */
        .content-section {
            display: none;
            padding: 40px;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* DASHBOARD */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #764ba2;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 14px;
        }
        
        /* FORMS */
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* TYPE SELECTOR */
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .type-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #64748b;
        }
        
        .type-option:hover {
            border-color: #cbd5e1;
            background: white;
        }
        
        .type-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .type-option.selected i {
            color: white;
        }
        
        /* IMAGE PREVIEW */
        .image-preview-container {
            margin-top: 10px;
            text-align: center;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            border: 2px dashed #e2e8f0;
            padding: 5px;
            display: none;
            margin: 10px auto;
        }
        
        .image-preview.visible {
            display: block;
        }
        
        .preview-loading {
            color: #64748b;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .preview-error {
            color: #dc2626;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .preview-btn {
            background: #e2e8f0;
            color: #64748b;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .preview-btn:hover {
            background: #cbd5e1;
        }
        
        /* SUBMIT BUTTON */
        .submit-btn {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            margin-top: 20px;
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ITEMS LIST */
        .items-list {
            margin-top: 30px;
        }
        
        .item-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .item-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .item-description {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .item-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            color: #94a3b8;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .edit-btn {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #93c5fd;
        }
        
        .edit-btn:hover {
            background: #93c5fd;
        }
        
        .delete-btn {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .delete-btn:hover {
            background: #fecaca;
        }
        
        /* TYPE BADGES */
        .type-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .event-badge {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .news-badge {
            background: #f0fdf4;
            color: #059669;
        }
        
        /* MESSAGES */
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            text-align: center;
            display: none;
        }
        
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
            display: block;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
            display: block;
        }
        
        /* EDIT MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-close {
            background: #64748b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .item-card {
                flex-direction: column;
                text-align: center;
            }
            
            .item-image {
                width: 100%;
                max-width: 300px;
            }
            
            .item-actions {
                justify-content: center;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cog"></i> Simple Admin Panel</h1>
            <p>Manage Events & Brands</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="tab" onclick="switchTab('events')">
                <i class="fas fa-calendar-alt"></i> Events & News
            </div>
            <div class="tab" onclick="switchTab('brands')">
                <i class="fas fa-store"></i> Brands
            </div>
        </div>
        
        <!-- DASHBOARD -->
        <div id="dashboard-tab" class="content-section active">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="eventsCount">0</div>
                    <div class="stat-label">Total Events</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="newsCount">0</div>
                    <div class="stat-label">Total News</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="brandsCount">0</div>
                    <div class="stat-label">Total Brands</div>
                </div>
            </div>
            
            <div class="items-list">
                <h2 style="color: #1e293b; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">
                    <i class="fas fa-history"></i> Recent Items
                </h2>
                <div id="recentItems"></div>
            </div>
        </div>
        
        <!-- EVENTS & NEWS -->
        <div id="events-tab" class="content-section">
            <div class="form-container">
                <h2 style="color: #1e293b; margin-bottom: 25px; text-align: center; font-size: 20px;">
                    <i class="fas fa-plus-circle"></i> Add New Event or News
                </h2>
                
                <div id="eventMessage" class="message"></div>
                
                <form id="eventForm">
                    <!-- TYPE SELECTOR -->
                    <div class="type-selector">
                        <div class="type-option selected" id="eventTypeOption" onclick="selectType('event')">
                            <i class="fas fa-calendar-day"></i> Event
                        </div>
                        <div class="type-option" id="newsTypeOption" onclick="selectType('news')">
                            <i class="fas fa-newspaper"></i> News
                        </div>
                    </div>
                    
                    <input type="hidden" id="itemType" value="event">
                    
                    <div class="form-group">
                        <label for="eventName" id="titleLabel">Event Title</label>
                        <input type="text" id="eventName" placeholder="Enter title">
                    </div>
                    
                    <div class="form-group">
                        <label for="eventDescription">Description</label>
                        <textarea id="eventDescription" placeholder="Enter description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventImageUrl">Image URL</label>
                        <input type="text" id="eventImageUrl" placeholder="https://example.com/image.jpg" oninput="previewImage('event')">
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                            Use free image hosting: <a href="https://imgbb.com/" target="_blank">ImgBB</a>, 
                            <a href="https://imgur.com/" target="_blank">Imgur</a>, or 
                            <a href="https://postimages.org/" target="_blank">Postimages</a>
                        </div>
                        <div id="eventPreviewContainer" class="image-preview-container">
                            <img id="eventPreview" class="image-preview" alt="Image Preview">
                            <div id="eventPreviewLoading" class="preview-loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Loading preview...
                            </div>
                            <div id="eventPreviewError" class="preview-error" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Unable to load image
                            </div>
                            <button type="button" id="eventPreviewBtn" class="preview-btn" onclick="forcePreview('event')" style="display: none;">
                                <i class="fas fa-eye"></i> Show Preview
                            </button>
                        </div>
                    </div>
                    
                    <!-- DATE FIELD - Only shown for Events -->
                    <div class="form-group" id="dateFieldGroup">
                        <label for="eventTime">Date & Time</label>
                        <input type="datetime-local" id="eventTime">
                    </div>
                    
                    <button type="submit" class="submit-btn" id="eventSubmitBtn">
                        <i class="fas fa-plus"></i> Add Event
                    </button>
                </form>
                
                <div class="items-list">
                    <h2 style="color: #1e293b; margin: 40px 0 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">
                        <i class="fas fa-list"></i> All Events & News
                    </h2>
                    <div id="eventsList"></div>
                </div>
            </div>
        </div>
        
        <!-- BRANDS -->
        <div id="brands-tab" class="content-section">
            <div class="form-container">
                <h2 style="color: #1e293b; margin-bottom: 25px; text-align: center; font-size: 20px;">
                    <i class="fas fa-plus-circle"></i> Add New Brand
                </h2>
                
                <div id="brandMessage" class="message"></div>
                
                <form id="brandForm">
                    <div class="form-group">
                        <label for="brandName">Brand Name</label>
                        <input type="text" id="brandName" placeholder="Enter brand name">
                    </div>
                    
                    <div class="form-group">
                        <label for="brandDescription">Description</label>
                        <textarea id="brandDescription" placeholder="Enter brand description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="brandImageUrl">Image URL</label>
                        <input type="text" id="brandImageUrl" placeholder="https://example.com/brand-logo.jpg" oninput="previewImage('brand')">
                        <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                            Use free image hosting: <a href="https://imgbb.com/" target="_blank">ImgBB</a>, 
                            <a href="https://imgur.com/" target="_blank">Imgur</a>, or 
                            <a href="https://postimages.org/" target="_blank">Postimages</a>
                        </div>
                        <div id="brandPreviewContainer" class="image-preview-container">
                            <img id="brandPreview" class="image-preview" alt="Image Preview">
                            <div id="brandPreviewLoading" class="preview-loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Loading preview...
                            </div>
                            <div id="brandPreviewError" class="preview-error" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Unable to load image
                            </div>
                            <button type="button" id="brandPreviewBtn" class="preview-btn" onclick="forcePreview('brand')" style="display: none;">
                                <i class="fas fa-eye"></i> Show Preview
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="brandPrize">Prize</label>
                        <input type="text" id="brandPrize" placeholder="Enter prize details">
                    </div>
                    
                    <div class="form-group">
                        <label for="brandContact">Contact Info</label>
                        <input type="text" id="brandContact" placeholder="Enter contact info">
                    </div>
                    
                    <div class="form-group">
                        <label for="brandLocation">Location</label>
                        <input type="text" id="brandLocation" placeholder="Enter location">
                    </div>
                    
                    <button type="submit" class="submit-btn" id="brandSubmitBtn">
                        <i class="fas fa-plus"></i> Add Brand
                    </button>
                </form>
                
                <div class="items-list">
                    <h2 style="color: #1e293b; margin: 40px 0 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">
                        <i class="fas fa-list"></i> All Brands
                    </h2>
                    <div id="brandsList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Edit Item</div>
            <form id="editForm">
                <!-- TYPE SELECTOR FOR EDIT MODAL -->
                <div class="type-selector" id="editTypeSelector">
                    <div class="type-option selected" id="editEventTypeOption" onclick="selectEditType('event')">
                        <i class="fas fa-calendar-day"></i> Event
                    </div>
                    <div class="type-option" id="editNewsTypeOption" onclick="selectEditType('news')">
                        <i class="fas fa-newspaper"></i> News
                    </div>
                </div>
                
                <input type="hidden" id="editItemType" value="event">
                
                <div class="form-group">
                    <label for="editName">Title</label>
                    <input type="text" id="editName">
                </div>
                
                <div class="form-group">
                    <label for="editDescription">Description</label>
                    <textarea id="editDescription"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editImageUrl">Image URL</label>
                    <input type="text" id="editImageUrl" oninput="previewImage('edit')">
                    <div id="editPreviewContainer" class="image-preview-container">
                        <img id="editPreview" class="image-preview" alt="Image Preview">
                        <div id="editPreviewLoading" class="preview-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Loading preview...
                        </div>
                        <div id="editPreviewError" class="preview-error" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i> Unable to load image
                        </div>
                        <button type="button" id="editPreviewBtn" class="preview-btn" onclick="forcePreview('edit')" style="display: none;">
                            <i class="fas fa-eye"></i> Show Preview
                        </button>
                    </div>
                </div>
                
                <div id="editExtraFields"></div>
                
                <input type="hidden" id="editId">
                <input type="hidden" id="editType">
                
                <button type="submit" class="submit-btn">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
            
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyA8XaUNfLDq6PYJu-LC0y_5ClAkGNfrLaw",
            authDomain: "medsphere-c73e4.firebasestorage.app",
            databaseURL: "https://medsphere-c73e4-default-rtdb.firebaseio.com",
            projectId: "medsphere-c73e4",
            storageBucket: "medsphere-c73e4.firebasestorage.app",
            messagingSenderId: "289749352034",
            appId: "1:289749352034:web:57fb380ac94433148bdb3b"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let events = [];
        let brands = [];

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab[onclick*="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'dashboard') loadDashboard();
            if (tabName === 'events') loadEvents();
            if (tabName === 'brands') loadBrands();
        }

        // Select type (Event or News)
        function selectType(type) {
            const eventOption = document.getElementById('eventTypeOption');
            const newsOption = document.getElementById('newsTypeOption');
            const dateFieldGroup = document.getElementById('dateFieldGroup');
            const titleLabel = document.getElementById('titleLabel');
            const submitBtn = document.getElementById('eventSubmitBtn');
            const itemTypeInput = document.getElementById('itemType');
            
            if (type === 'event') {
                eventOption.classList.add('selected');
                newsOption.classList.remove('selected');
                dateFieldGroup.style.display = 'block';
                titleLabel.textContent = 'Event Title';
                submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Event';
            } else {
                newsOption.classList.add('selected');
                eventOption.classList.remove('selected');
                dateFieldGroup.style.display = 'none';
                titleLabel.textContent = 'News Title';
                submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add News';
            }
            
            itemTypeInput.value = type;
        }

        // Select type for edit modal
        function selectEditType(type) {
            const eventOption = document.getElementById('editEventTypeOption');
            const newsOption = document.getElementById('editNewsTypeOption');
            const dateFieldGroup = document.getElementById('editDateFieldGroup');
            const itemTypeInput = document.getElementById('editItemType');
            
            if (type === 'event') {
                eventOption.classList.add('selected');
                newsOption.classList.remove('selected');
                if (dateFieldGroup) dateFieldGroup.style.display = 'block';
            } else {
                newsOption.classList.add('selected');
                eventOption.classList.remove('selected');
                if (dateFieldGroup) dateFieldGroup.style.display = 'none';
            }
            
            itemTypeInput.value = type;
        }

        // URL validation function
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Image Preview Function
        async function previewImage(type) {
            const urlInput = document.getElementById(`${type}ImageUrl`);
            const previewImg = document.getElementById(`${type}Preview`);
            const loadingDiv = document.getElementById(`${type}PreviewLoading`);
            const errorDiv = document.getElementById(`${type}PreviewError`);
            const previewBtn = document.getElementById(`${type}PreviewBtn`);
            const url = urlInput.value.trim();
            
            // Hide all preview elements initially
            previewImg.classList.remove('visible');
            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            previewBtn.style.display = 'none';
            
            // If URL is empty, hide preview
            if (!url) return;
            
            // Validate URL format
            if (!url.startsWith('http')) {
                previewBtn.style.display = 'block';
                return;
            }
            
            // Show loading indicator
            loadingDiv.style.display = 'block';
            
            try {
                // Create an image object to test if it loads
                const testImage = new Image();
                
                testImage.onload = function() {
                    // Success - show the preview
                    previewImg.src = url;
                    previewImg.classList.add('visible');
                    loadingDiv.style.display = 'none';
                    previewBtn.style.display = 'none';
                };
                
                testImage.onerror = function() {
                    // Error loading image
                    loadingDiv.style.display = 'none';
                    errorDiv.style.display = 'block';
                    previewBtn.style.display = 'block';
                };
                
                // Set a timeout to prevent hanging
                setTimeout(() => {
                    if (!previewImg.classList.contains('visible')) {
                        loadingDiv.style.display = 'none';
                        errorDiv.style.display = 'block';
                        previewBtn.style.display = 'block';
                    }
                }, 5000);
                
                testImage.src = url;
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                previewBtn.style.display = 'block';
            }
        }

        // Force preview button click
        function forcePreview(type) {
            const urlInput = document.getElementById(`${type}ImageUrl`);
            const previewImg = document.getElementById(`${type}Preview`);
            const previewBtn = document.getElementById(`${type}PreviewBtn`);
            const errorDiv = document.getElementById(`${type}PreviewError`);
            const url = urlInput.value.trim();
            
            if (url) {
                previewImg.src = url;
                previewImg.classList.add('visible');
                previewBtn.style.display = 'none';
                errorDiv.style.display = 'none';
            }
        }

        // Add Event or News
        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('eventSubmitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            submitBtn.disabled = true;

            try {
                const name = document.getElementById('eventName').value.trim();
                const description = document.getElementById('eventDescription').value.trim();
                const time = document.getElementById('eventTime').value;
                const imageUrl = document.getElementById('eventImageUrl').value.trim();
                const type = document.getElementById('itemType').value; // 'event' or 'news'

                // ALL FIELDS ARE NOW OPTIONAL - Create item with available data
                if (!name && !description && !imageUrl) {
                    showMessage('eventMessage', 'Please fill at least one field', 'error');
                    throw new Error('No data provided');
                }

                // Validate URL format if provided
                if (imageUrl && !isValidUrl(imageUrl)) {
                    showMessage('eventMessage', 'Please enter a valid image URL (start with http:// or https://)', 'error');
                    throw new Error('Invalid image URL');
                }

                // Create item data - FIXED: Ensure type is always included
                const itemId = `${type}_` + Date.now();
                const itemData = {
                    id: itemId,
                    name: name || `Untitled ${type === 'event' ? 'Event' : 'News'}`,
                    description: description || 'No description provided',
                    imageUrl: imageUrl || (type === 'event' ? 
                        'https://via.placeholder.com/400x200/667eea/ffffff?text=No+Image' : 
                        'https://via.placeholder.com/400x200/059669/ffffff?text=No+Image'),
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    type: type // CRITICAL FIX: Always include the type field
                };

                // Add date only for events
if (type === 'event') {
    itemData.time = time || new Date().toISOString();
}

                console.log('Saving item:', itemData);

                // Save to database
                await database.ref('events/' + itemId).set(itemData);

                // Success
                showMessage('eventMessage', `✅ ${type === 'event' ? 'Event' : 'News'} added successfully!`, 'success');
                
                // Reset form
                this.reset();
                document.getElementById('eventPreview').classList.remove('visible');
                
                // Reset to default (Event)
                selectType('event');
                
                // Refresh
                setTimeout(() => {
                    loadEvents();
                    loadDashboard();
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                showMessage('eventMessage', `❌ Error: ${error.message}`, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Add Brand
        document.getElementById('brandForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('brandSubmitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            submitBtn.disabled = true;

            try {
                const name = document.getElementById('brandName').value.trim();
                const description = document.getElementById('brandDescription').value.trim();
                const prize = document.getElementById('brandPrize').value.trim();
                const contact = document.getElementById('brandContact').value.trim();
                const location = document.getElementById('brandLocation').value.trim();
                const imageUrl = document.getElementById('brandImageUrl').value.trim();

                // ALL FIELDS ARE NOW OPTIONAL - Create brand with available data
                if (!name && !description && !imageUrl) {
                    showMessage('brandMessage', 'Please fill at least one field', 'error');
                    throw new Error('No data provided');
                }

                // Validate URL format if provided
                if (imageUrl && !isValidUrl(imageUrl)) {
                    showMessage('brandMessage', 'Please enter a valid image URL (start with http:// or https://)', 'error');
                    throw new Error('Invalid image URL');
                }

                // Create brand data
                const brandId = 'brand_' + Date.now();
                const brandData = {
                    id: brandId,
                    name: name || 'Untitled Brand',
                    description: description || 'No description provided',
                    imageUrl: imageUrl || 'https://via.placeholder.com/400x200/764ba2/ffffff?text=No+Image',
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                };

                // Add optional fields if provided
                if (prize) brandData.prize = prize;
                if (contact) brandData.contact = contact;
                if (location) brandData.location = location;

                console.log('Saving brand:', brandData);

                // Save to database
                await database.ref('brands/' + brandId).set(brandData);

                // Success
                showMessage('brandMessage', '✅ Brand added successfully!', 'success');
                
                // Reset form
                this.reset();
                document.getElementById('brandPreview').classList.remove('visible');
                
                // Refresh
                setTimeout(() => {
                    loadBrands();
                    loadDashboard();
                }, 1000);

            } catch (error) {
                console.error('Error:', error);
                showMessage('brandMessage', `❌ Error: ${error.message}`, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Load Events & News - FIXED VERSION
async function loadEvents() {
    const eventsList = document.getElementById('eventsList');
    eventsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">Loading events & news...</div>';

    try {
        const snapshot = await database.ref('events').once('value');
        const data = snapshot.val();
        console.log('Loaded events & news:', data);
        
        if (!data) {
            eventsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">No events or news added yet.</div>';
            return;
        }

        eventsList.innerHTML = '';
        Object.entries(data).forEach(([key, item]) => {
            // *** FIXED LOGIC: Determine if event or news ***
            // 1. First check if item has 'type' field
            // 2. If no type field, check if it has 'time' field (events have time, news don't)
            // 3. If no type AND no time, it's probably old data - treat as news
            
            let isEvent = false;
            let isNews = false;
            
            if (item.type) {
                // Item has type field
                isEvent = item.type === 'event';
                isNews = item.type === 'news';
            } else {
                // Old item without type field
                isEvent = item.time ? true : false;  // Has time = event
                isNews = !item.time;                 // No time = news
            }
            
            // *** FIXED: Use the correct type for display ***
            const typeBadge = isEvent ? 
                '<div class="type-badge event-badge">EVENT</div>' : 
                '<div class="type-badge news-badge">NEWS</div>';
            
            // *** FIXED: Date display ***
            let dateDisplay = '';
            if (isEvent && item.time) {
                const itemDate = new Date(item.time);
                dateDisplay = `${itemDate.toLocaleDateString()} at ${itemDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            } else if (item.createdAt) {
                const itemDate = new Date(item.createdAt);
                dateDisplay = itemDate.toLocaleDateString();
            } else {
                dateDisplay = 'No date';
            }
            
            const placeholderImage = isEvent ? 
                'https://via.placeholder.com/300x200/667eea/ffffff?text=EVENT' :
                'https://via.placeholder.com/300x200/059669/ffffff?text=NEWS';
            
            const itemCard = document.createElement('div');
            itemCard.className = 'item-card';
            itemCard.innerHTML = `
                <img src="${item.imageUrl || placeholderImage}" alt="${item.name}" class="item-image" onerror="this.src='${placeholderImage}'">
                <div class="item-details">
                    ${typeBadge}
                    <div class="item-title">${item.name}</div>
                    <p class="item-description">${item.description}</p>
                    <div class="item-info">
                        <div class="info-item">
                            <i class="fas fa-calendar"></i>
                            ${dateDisplay}
                        </div>
                        ${isEvent && item.time ? `
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            ${new Date(item.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </div>
                        ` : ''}
                    </div>
                </div>
                <div class="item-actions">
                    <button class="action-btn edit-btn" onclick="editItem('events', '${key}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteItem('events', '${key}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            eventsList.appendChild(itemCard);
        });

    } catch (error) {
        console.error('Error loading events & news:', error);
        eventsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Error loading events & news.</div>';
    }
}

        // Load Brands
        async function loadBrands() {
            const brandsList = document.getElementById('brandsList');
            brandsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">Loading brands...</div>';

            try {
                const snapshot = await database.ref('brands').once('value');
                const data = snapshot.val();
                console.log('Loaded brands:', data);
                
                if (!data) {
                    brandsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">No brands added yet.</div>';
                    return;
                }

                brandsList.innerHTML = '';
                Object.entries(data).forEach(([key, brand]) => {
                    const item = document.createElement('div');
                    item.className = 'item-card';
                    item.innerHTML = `
                        <img src="${brand.imageUrl}" alt="${brand.name}" class="item-image" onerror="this.src='https://via.placeholder.com/300x200/667eea/ffffff?text=BRAND'">
                        <div class="item-details">
                            <div class="item-title">${brand.name}</div>
                            <p class="item-description">${brand.description}</p>
                            <div class="item-info">
                                ${brand.prize ? `<div class="info-item"><i class="fas fa-trophy"></i> ${brand.prize}</div>` : ''}
                                ${brand.contact ? `<div class="info-item"><i class="fas fa-phone"></i> ${brand.contact}</div>` : ''}
                                ${brand.location ? `<div class="info-item"><i class="fas fa-map-marker"></i> ${brand.location}</div>` : ''}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="action-btn edit-btn" onclick="editItem('brands', '${key}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem('brands', '${key}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                    brandsList.appendChild(item);
                });

            } catch (error) {
                console.error('Error loading brands:', error);
                brandsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;">Error loading brands.</div>';
            }
        }

        // Load Dashboard - FIXED: Better type counting
        async function loadDashboard() {
            try {
                // Load events and news count
                const eventsSnapshot = await database.ref('events').once('value');
                const eventsData = eventsSnapshot.val();
                let eventsCount = 0;
                let newsCount = 0;
                
                // Inside loadDashboard() function, update this part:
if (eventsData) {
    Object.values(eventsData).forEach(item => {
        // Check if item has type field
        if (item.type === 'event') {
            eventsCount++;
        } else if (item.type === 'news') {
            newsCount++;
        } else {
            // Old item without type field
            if (item.time) {
                eventsCount++; // Has time = event
            } else {
                newsCount++; // No time = news
            }
        }
    });
}
                
                document.getElementById('eventsCount').textContent = eventsCount;
                document.getElementById('newsCount').textContent = newsCount;
                
                // Load brands count
                const brandsSnapshot = await database.ref('brands').once('value');
                const brandsData = brandsSnapshot.val();
                const brandsCount = brandsData ? Object.keys(brandsData).length : 0;
                document.getElementById('brandsCount').textContent = brandsCount;
                
                // Load recent items
                const recentItems = document.getElementById('recentItems');
                const allItems = [];
                
                if (eventsData) {
                    Object.entries(eventsData).forEach(([key, value]) => {
                        // Determine type for display
                        let displayType = value.type;
                        if (!displayType) {
                            displayType = value.time ? 'event' : 'news';
                        }
                        
                        allItems.push({
                            ...value,
                            key: key,
                            type: displayType
                        });
                    });
                }
                
                if (brandsData) {
                    Object.entries(brandsData).forEach(([key, value]) => {
                        allItems.push({
                            ...value,
                            key: key,
                            type: 'brand'
                        });
                    });
                }
                
                // Sort by creation date
                allItems.sort((a, b) => b.createdAt - a.createdAt);
                const recent = allItems.slice(0, 5);
                
                if (recent.length === 0) {
                    recentItems.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">No items yet.</div>';
                } else {
                    recentItems.innerHTML = '';
                    recent.forEach(item => {
                        let typeText = '';
                        let badgeClass = '';
                        
                        if (item.type === 'event') {
                            typeText = 'EVENT';
                            badgeClass = 'event-badge';
                        } else if (item.type === 'news') {
                            typeText = 'NEWS';
                            badgeClass = 'news-badge';
                        } else if (item.type === 'brand') {
                            typeText = 'BRAND';
                            badgeClass = '';
                        }
                        
                        const itemCard = document.createElement('div');
                        itemCard.className = 'item-card';
                        
                        const typeBadge = badgeClass ? 
                            `<div class="type-badge ${badgeClass}">${typeText}</div>` : 
                            `<span style="background: #f0fdf4; color: #059669; padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">${typeText}</span>`;
                        
                        const placeholderImage = item.type === 'event' ? 
                            'https://via.placeholder.com/300x200/667eea/ffffff?text=EVENT' :
                            item.type === 'news' ? 
                            'https://via.placeholder.com/300x200/059669/ffffff?text=NEWS' :
                            'https://via.placeholder.com/300x200/764ba2/ffffff?text=BRAND';
                        
                        itemCard.innerHTML = `
                            <img src="${item.imageUrl || placeholderImage}" alt="${item.name}" class="item-image" onerror="this.src='${placeholderImage}'">
                            <div class="item-details">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div class="item-title">${item.name}</div>
                                    ${typeBadge}
                                </div>
                                <p class="item-description">${item.description ? item.description.substring(0, 80) + '...' : 'No description'}</p>
                                <div style="font-size: 12px; color: #94a3b8; margin-top: 5px;">
                                    <i class="fas fa-clock"></i> ${new Date(item.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                        `;
                        recentItems.appendChild(itemCard);
                    });
                }

            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Edit Item
        async function editItem(type, id) {
            try {
                const snapshot = await database.ref(`${type}/${id}`).once('value');
                const item = snapshot.val();
                
                if (!item) return;
                
                // Set modal title
                document.getElementById('modalTitle').textContent = type === 'events' ? 'Edit Event/News' : 'Edit Brand';
                document.getElementById('editId').value = id;
                document.getElementById('editType').value = type;
                document.getElementById('editName').value = item.name;
                document.getElementById('editDescription').value = item.description;
                document.getElementById('editImageUrl').value = item.imageUrl;
                
                // Clear extra fields
                const extraFields = document.getElementById('editExtraFields');
                extraFields.innerHTML = '';
                
                // Determine item type for events/news
                if (type === 'events') {
                    // Determine type - check for existing type or time field
                    let itemType = item.type;
                    if (!itemType) {
                        itemType = item.time ? 'event' : 'news';
                    }
                    
                    // Set the type selection
                    document.getElementById('editItemType').value = itemType;
                    
                    // Select the correct type in the modal
                    selectEditType(itemType);
                    
                    // Add date field only for events
                    if (itemType === 'event') {
                        extraFields.innerHTML = `
                            <div class="form-group" id="editDateFieldGroup">
                                <label for="editTime">Date & Time</label>
                                <input type="datetime-local" id="editTime" value="${item.time ? item.time.slice(0,16) : new Date().toISOString().slice(0,16)}">
                            </div>
                        `;
                    } else {
                        extraFields.innerHTML = '';
                    }
                } else if (type === 'brands') {
                    extraFields.innerHTML = `
                        <div class="form-group">
                            <label for="editPrize">Prize</label>
                            <input type="text" id="editPrize" value="${item.prize || ''}" placeholder="Prize details">
                        </div>
                        <div class="form-group">
                            <label for="editContact">Contact Info</label>
                            <input type="text" id="editContact" value="${item.contact || ''}" placeholder="Contact info">
                        </div>
                        <div class="form-group">
                            <label for="editLocation">Location</label>
                            <input type="text" id="editLocation" value="${item.location || ''}" placeholder="Location">
                        </div>
                    `;
                }
                
                // Show preview if image exists
                if (item.imageUrl) {
                    document.getElementById('editPreview').src = item.imageUrl;
                    document.getElementById('editPreview').classList.add('visible');
                }
                
                // Show modal
                document.getElementById('editModal').classList.add('active');
                
            } catch (error) {
                console.error('Error loading item for edit:', error);
                showMessage(type === 'events' ? 'eventMessage' : 'brandMessage', 'Error loading item', 'error');
            }
        }

        // Handle Edit Form Submission
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const id = document.getElementById('editId').value;
                const type = document.getElementById('editType').value;
                const name = document.getElementById('editName').value.trim();
                const description = document.getElementById('editDescription').value.trim();
                const imageUrl = document.getElementById('editImageUrl').value.trim();
                
                // Get existing data
                const snapshot = await database.ref(`${type}/${id}`).once('value');
                const existingData = snapshot.val();
                
                // Prepare update data
                const updateData = {
                    ...existingData,
                    name: name || existingData.name,
                    description: description || existingData.description,
                    imageUrl: imageUrl || existingData.imageUrl,
                    updatedAt: Date.now()
                };
                
                // Add type-specific fields for events/news
                if (type === 'events') {
                    const itemType = document.getElementById('editItemType').value;
                    updateData.type = itemType; // Always set type
                    
                    if (itemType === 'event') {
                        updateData.time = document.getElementById('editTime').value || existingData.time || new Date().toISOString();
                    } else {
                        // Remove time field for news
                        delete updateData.time;
                    }
                } else if (type === 'brands') {
                    updateData.prize = document.getElementById('editPrize').value.trim() || existingData.prize || '';
                    updateData.contact = document.getElementById('editContact').value.trim() || existingData.contact || '';
                    updateData.location = document.getElementById('editLocation').value.trim() || existingData.location || '';
                }
                
                // Update database
                await database.ref(`${type}/${id}`).set(updateData);
                
                // Success
                showMessage(type === 'events' ? 'eventMessage' : 'brandMessage', '✅ Item updated successfully!', 'success');
                
                // Close modal and refresh
                closeModal();
                if (type === 'events') loadEvents();
                if (type === 'brands') loadBrands();
                loadDashboard();
                
            } catch (error) {
                console.error('Error updating item:', error);
                showMessage('Error updating item', 'error');
            }
        });

        // Delete Item
        async function deleteItem(type, id) {
            if (confirm('Are you sure you want to delete this item?')) {
                try {
                    await database.ref(`${type}/${id}`).remove();
                    
                    showMessage(type === 'events' ? 'eventMessage' : 'brandMessage', '✅ Item deleted successfully!', 'success');
                    
                    if (type === 'events') loadEvents();
                    if (type === 'brands') loadBrands();
                    loadDashboard();
                    
                } catch (error) {
                    console.error('Error deleting item:', error);
                    showMessage(type === 'events' ? 'eventMessage' : 'brandMessage', '❌ Error deleting item', 'error');
                }
            }
        }

        // Close Modal
        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editForm').reset();
            document.getElementById('editPreview').classList.remove('visible');
        }

        // Show Message
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `message ${type}`;
                element.style.display = 'block';
                
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            } else {
                alert(message);
            }
        }

        // Auto-migrate existing items that don't have type field
        async function migrateExistingItems() {
            try {
                console.log('Checking for items that need migration...');
                const snapshot = await database.ref('events').once('value');
                const data = snapshot.val();
                
                if (!data) return;
                
                let migrationCount = 0;
                const updates = {};
                
                Object.entries(data).forEach(([key, item]) => {
                    if (!item.type) {
                        // Determine type based on time field
                        const newType = item.time ? 'event' : 'news';
                        updates[key] = {
                            ...item,
                            type: newType
                        };
                        migrationCount++;
                        console.log(`Will migrate ${key} to ${newType} (${item.name})`);
                    }
                });
                
                if (migrationCount > 0) {
                    console.log(`Migrating ${migrationCount} items...`);
                    await database.ref('events').update(updates);
                    console.log(`✅ Migration complete: ${migrationCount} items updated`);
                    // Refresh the display
                    loadEvents();
                    loadDashboard();
                }
                
            } catch (error) {
                console.error('Migration error:', error);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin panel loaded');
            // Set default to Event type
            selectType('event');
            loadEvents();
            loadBrands();
            loadDashboard();
            
            // Run migration for existing items
            setTimeout(migrateExistingItems, 1000);
        });

        // Test Firebase connection
        async function testConnection() {
            try {
                console.log('Testing Firebase connection...');
                const testRef = database.ref('test');
                await testRef.set({ test: Date.now() });
                await testRef.remove();
                console.log('✅ Firebase connection successful');
                return true;
            } catch (error) {
                console.error('❌ Firebase connection failed:', error);
                alert('Firebase connection failed: ' + error.message);
                return false;
            }
        }

        // Run connection test
        testConnection();
    </script>
</body>
</html>