<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Campus Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            background: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header-left p {
            color: #666;
            font-size: 16px;
        }
        
        .header-right {
            text-align: right;
        }
        
        .stats-summary {
            display: flex;
            gap: 20px;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .admin-panel {
            background: white;
            padding: 30px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 2px;
        }
        
        /* Navigation Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background: #e9e9e9;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Containers */
        .form-container {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* Image Preview */
        .image-preview-container {
            margin-top: 15px;
            display: none;
        }
        
        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
            margin-top: 10px;
        }
        
        /* Category Badges */
        .category-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .category-option {
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .category-option:hover {
            background: #e0e0e0;
        }
        
        .category-option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        /* Form Buttons */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        /* Items List */
        .items-list {
            margin-top: 30px;
        }
        
        .items-list h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .item-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.1);
        }
        
        .item-image {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-info h4 {
            color: #333;
            margin-bottom: 5px;
            font-size: 18px;
        }
        
        .item-info p {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .item-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .date-badge {
            background: #f0f5ff;
            color: #667eea;
        }
        
        .type-badge {
            background: #f0fff4;
            color: #52c41a;
        }
        
        .featured-badge {
            background: #fff7e6;
            color: #fa8c16;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-edit {
            background: #e8f4ff;
            color: #1890ff;
        }
        
        .btn-delete {
            background: #ffe8e8;
            color: #ff4d4f;
        }
        
        .btn-edit:hover {
            background: #d0e8ff;
        }
        
        .btn-delete:hover {
            background: #ffd0d0;
        }
        
        /* Brands Grid */
        .brands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .brand-card {
            border: 2px solid #eee;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .brand-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }
        
        .brand-image {
            height: 200px;
            overflow: hidden;
        }
        
        .brand-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .brand-content {
            padding: 20px;
        }
        
        .brand-name {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .brand-category {
            display: inline-block;
            background: #f0f5ff;
            color: #667eea;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .brand-price {
            font-size: 18px;
            font-weight: bold;
            color: #52c41a;
            margin-bottom: 10px;
        }
        
        .brand-info {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .brand-contact {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
        }
        
        .brand-location,
        .brand-phone {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        /* Checkbox Styles */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }
        
        /* Preview */
        .preview-container {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }
        
        .preview-container h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .preview-event {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #eee;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 25px;
        }
        
        .dashboard-card h3 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Image Placeholder */
        .image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .item-card {
                flex-direction: column;
                gap: 15px;
            }
            
            .item-image {
                width: 100%;
                height: 200px;
                margin-right: 0;
            }
            
            .item-actions {
                align-self: flex-end;
            }
            
            .stats-summary {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-right {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="header-left">
                <h1>üè´ Campus Management Dashboard</h1>
                <p>Manage events and sponsored brands in one place</p>
            </div>
            <div class="header-right">
                <div class="stats-summary">
                    <div class="stat-item">
                        <div class="stat-number" id="total-events">0</div>
                        <div class="stat-label">Events</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-brands">0</div>
                        <div class="stat-label">Sponsored Brands</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="featured-items">0</div>
                        <div class="stat-label">Featured</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="admin-panel">
            <!-- Navigation Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
                <button class="tab-btn" onclick="switchTab('add-event')">üìÖ Add Event</button>
                <button class="tab-btn" onclick="switchTab('manage-events')">üóìÔ∏è Manage Events</button>
                <button class="tab-btn" onclick="switchTab('add-brand')">üè™ Add Brand</button>
                <button class="tab-btn" onclick="switchTab('manage-brands')">üè¨ Manage Brands</button>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>üìà Quick Stats</h3>
                        <div class="form-group">
                            <label>Total Events:</label>
                            <div id="stat-total-events" style="font-size: 32px; color: #667eea; font-weight: bold;">0</div>
                        </div>
                        <div class="form-group">
                            <label>Active Brands:</label>
                            <div id="stat-active-brands" style="font-size: 32px; color: #52c41a; font-weight: bold;">0</div>
                        </div>
                        <div class="form-group">
                            <label>Upcoming Events:</label>
                            <div id="stat-upcoming-events" style="font-size: 32px; color: #fa8c16; font-weight: bold;">0</div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>‚è∞ Recent Activity</h3>
                        <div id="recent-activity" style="color: #666;">
                            <p>Loading recent activity...</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>üöÄ Quick Actions</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-primary" onclick="switchTab('add-event')">
                                ‚ûï Add New Event
                            </button>
                            <button class="btn btn-primary" onclick="switchTab('add-brand')">
                                ‚ûï Add New Brand
                            </button>
                            <button class="btn btn-secondary" onclick="clearAllData()">
                                üóëÔ∏è Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3>üìã Upcoming Events</h3>
                    <div id="dashboard-events">
                        <p style="color: #666;">Loading upcoming events...</p>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3>üè¢ Active Brands</h3>
                    <div id="dashboard-brands">
                        <p style="color: #666;">Loading active brands...</p>
                    </div>
                </div>
            </div>
            
            <!-- Add Event Tab -->
            <div id="add-event" class="tab-content">
                <div class="form-container">
                    <h2 style="color: #333; margin-bottom: 20px;">Add New Campus Event</h2>
                    
                    <div class="form-group">
                        <label>Event Title</label>
                        <input type="text" id="event-title" placeholder="e.g., Annual Career Fair 2025">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Event Date (Optional)</label>
                            <input type="date" id="event-date">
                        </div>
                        
                        <div class="form-group">
                            <label>Event Type (Optional)</label>
                            <select id="event-type">
                                <option value="">Select type (Optional)</option>
                                <option value="career">Career</option>
                                <option value="technology">Technology</option>
                                <option value="academic">Academic</option>
                                <option value="social">Social</option>
                                <option value="sports">Sports</option>
                                <option value="cultural">Cultural</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Location (Optional)</label>
                            <input type="text" id="event-location" placeholder="e.g., Main Auditorium">
                        </div>
                        
                        <div class="form-group">
                            <label>Time (Optional)</label>
                            <input type="text" id="event-time" placeholder="e.g., 10:00 AM ‚Äì 4:00 PM">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Event Image URL (Optional)</label>
                        <input type="url" id="event-image" placeholder="https://example.com/event-image.jpg" 
                               oninput="showImagePreview(this.value, 'event-preview-image')">
                        <div class="image-preview-container" id="event-image-preview">
                            <small style="color: #666;">Image Preview:</small>
                            <img id="event-preview-image" class="image-preview" src="" alt="Preview" 
                                 onerror="this.style.display='none'">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Category (Optional)</label>
                        <div class="category-options">
                            <div class="category-option" onclick="selectCategory(this, 'event')" data-category="regular">Regular</div>
                            <div class="category-option" onclick="selectCategory(this, 'event')" data-category="featured">Featured</div>
                        </div>
                        <input type="hidden" id="event-category" value="regular">
                    </div>
                    
                    <div class="form-group">
                        <label>Event Description (Optional)</label>
                        <textarea id="event-description" rows="4" placeholder="Describe the event..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Button Text (Optional)</label>
                        <input type="text" id="event-button" placeholder="e.g., Register Now, Join Workshop">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearEventForm()">Clear Form</button>
                        <button type="button" class="btn btn-primary" onclick="addEvent()">Add Event</button>
                    </div>
                </div>
            </div>
            
            <!-- Manage Events Tab -->
            <div id="manage-events" class="tab-content">
                <div class="items-list">
                    <h3>Upcoming Events</h3>
                    <div id="events-container">
                        <!-- Events will be dynamically added here -->
                    </div>
                </div>
            </div>
            
            <!-- Add Brand Tab -->
            <div id="add-brand" class="tab-content">
                <div class="form-container">
                    <h2 style="color: #333; margin-bottom: 20px;">Add Sponsored Brand</h2>
                    
                    <div class="form-group">
                        <label>Brand/Business Name</label>
                        <input type="text" id="brand-name" placeholder="e.g., Tech Solutions Inc.">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Category (Optional)</label>
                            <select id="brand-category">
                                <option value="">Select category (Optional)</option>
                                <option value="food">Food & Dining</option>
                                <option value="retail">Retail</option>
                                <option value="services">Services</option>
                                <option value="technology">Technology</option>
                                <option value="health">Health & Wellness</option>
                                <option value="education">Education</option>
                                <option value="entertainment">Entertainment</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Price/Plan (Optional)</label>
                            <input type="text" id="brand-price" placeholder="e.g., $99/month, Free Trial">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Contact Phone (Optional)</label>
                            <input type="tel" id="brand-phone" placeholder="e.g., (123) 456-7890">
                        </div>
                        
                        <div class="form-group">
                            <label>Location (Optional)</label>
                            <input type="text" id="brand-location" placeholder="e.g., 123 Main St, Campus">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Brand Image URL (Optional)</label>
                        <input type="url" id="brand-image" placeholder="https://example.com/brand-logo.jpg"
                               oninput="showImagePreview(this.value, 'brand-preview-image')">
                        <div class="image-preview-container" id="brand-image-preview">
                            <small style="color: #666;">Image Preview:</small>
                            <img id="brand-preview-image" class="image-preview" src="" alt="Preview"
                                 onerror="this.style.display='none'">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Description (Optional)</label>
                        <textarea id="brand-description" rows="4" placeholder="Describe your business..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Expiry Date (Optional)</label>
                            <input type="date" id="brand-expiry">
                        </div>
                        
                        <div class="form-group">
                            <label>Featured Listing (Optional)</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="brand-featured">
                                <label for="brand-featured">Mark as featured (‚≠ê)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearBrandForm()">Clear Form</button>
                        <button type="button" class="btn btn-primary" onclick="addBrand()">Add Brand</button>
                    </div>
                </div>
            </div>
            
            <!-- Manage Brands Tab -->
            <div id="manage-brands" class="tab-content">
                <div class="items-list">
                    <h3>Sponsored Brands</h3>
                    <div id="brands-container">
                        <!-- Brands will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
<script>
<!-- Add these Firebase SDKs BEFORE your script -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
// ======================
// COMPLETE FIREBASE ADMIN PANEL
// ======================

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyA8XaUNfLDq6PYJu-LC0y_5ClAkGNfrLaw",
    authDomain: "medsphere-c73e4.firebaseapp.com",
    databaseURL: "https://medsphere-c73e4-default-rtdb.firebaseio.com",
    projectId: "medsphere-c73e4",
    storageBucket: "medsphere-c73e4.firebasestorage.app",
    messagingSenderId: "289749352034",
    appId: "1:289749352034:web:57fb380ac94433148bdb3b"
};

// Initialize Firebase
let db = null;

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    try {
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log('‚úÖ Firebase Firestore ready');
        
        // Load initial data
        loadEvents();
        loadBrands();
        
        // Add test button
        const testBtn = document.createElement('button');
        testBtn.innerHTML = 'üîß TEST';
        testBtn.style.cssText = 'position:fixed; top:10px; right:10px; z-index:9999; background:red; color:white; padding:10px; border-radius:5px; border:none; cursor:pointer;';
        testBtn.onclick = async () => {
            try {
                const snapshot = await db.collection('events').get();
                alert(`‚úÖ Connected! Found ${snapshot.size} events`);
            } catch (err) {
                alert('‚ùå Error: ' + err.message);
            }
        };
        document.body.appendChild(testBtn);
        
    } catch (error) {
        console.error('‚ùå Firebase init error:', error);
        alert('Firebase failed to load: ' + error.message);
    }
});

// ========== EVENT FUNCTIONS ==========
async function addEvent() {
    console.log('üéØ Add Event clicked');
    
    if (!db) {
        alert('Database not ready yet. Wait for Firebase to load.');
        return;
    }
    
    const title = document.getElementById('event-title').value.trim();
    if (!title) {
        alert('Please enter event title');
        return;
    }
    
    try {
        const eventData = {
            title: title,
            description: document.getElementById('event-description').value.trim() || '',
            date: document.getElementById('event-date').value || null,
            location: document.getElementById('event-location').value.trim() || null,
            type: document.getElementById('event-type').value || null,
            time: document.getElementById('event-time').value.trim() || null,
            image: document.getElementById('event-image').value.trim() || null,
            category: document.getElementById('event-category').value || 'regular',
            buttonText: document.getElementById('event-button').value.trim() || null,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        console.log('üì§ Saving event to Firestore:', eventData);
        
        await db.collection('events').add(eventData);
        
        alert('‚úÖ Event added successfully!');
        
        // Clear form
        clearEventForm();
        
        // Refresh events list
        loadEvents();
        
        // Switch to dashboard
        switchTab('dashboard');
        
    } catch (error) {
        console.error('‚ùå Error adding event:', error);
        alert('Failed: ' + error.message);
    }
}

async function loadEvents() {
    if (!db) {
        console.log('Database not ready yet');
        return;
    }
    
    try {
        const snapshot = await db.collection('events')
            .orderBy('createdAt', 'desc')
            .get();
        
        const events = [];
        snapshot.forEach(doc => {
            events.push({
                id: doc.id,
                ...doc.data()
            });
        });
        
        console.log('üìä Loaded', events.length, 'events');
        
        // Update counters
        document.getElementById('total-events').textContent = events.length;
        document.getElementById('stat-total-events').textContent = events.length;
        
        // Display events
        displayEvents(events);
        displayDashboardEvents(events);
        
    } catch (error) {
        console.error('‚ùå Error loading events:', error);
    }
}

function displayEvents(events) {
    const container = document.getElementById('events-container');
    if (!container) return;
    
    if (!events || events.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No events yet. Add your first event!</p></div>';
        return;
    }
    
    container.innerHTML = events.map(event => {
        const date = event.date ? new Date(event.date).toLocaleDateString() : 'No date';
        const location = event.location || 'Location not specified';
        
        return `
        <div class="item-card">
            <div class="item-image">
                ${event.image ? 
                    `<img src="${event.image}" alt="${event.title}">` : 
                    `<div class="image-placeholder">üìÖ</div>`
                }
            </div>
            <div class="item-info">
                <h4>${event.title}</h4>
                <p>${event.description || 'No description'}</p>
                <div class="item-meta">
                    <span class="meta-badge date-badge">üìÖ ${date}</span>
                    <span class="meta-badge">üìç ${location}</span>
                    ${event.category === 'featured' ? 
                        `<span class="meta-badge featured-badge">‚≠ê Featured</span>` : 
                        ''
                    }
                </div>
            </div>
            <div class="item-actions">
                <button class="btn-small btn-delete" onclick="deleteEvent('${event.id}')">Delete</button>
            </div>
        </div>
        `;
    }).join('');
}

function displayDashboardEvents(events) {
    const container = document.getElementById('dashboard-events');
    if (!container) return;
    
    const recentEvents = events.slice(0, 3);
    
    if (recentEvents.length === 0) {
        container.innerHTML = '<p style="color: #666;">No events yet</p>';
        return;
    }
    
    container.innerHTML = recentEvents.map(event => {
        const date = event.date ? new Date(event.date).toLocaleDateString() : 'No date';
        return `
        <div style="padding: 15px; border-bottom: 1px solid #eee; margin-bottom: 10px;">
            <div style="font-weight: bold; color: #333;">${event.title}</div>
            <div style="color: #666; font-size: 14px; margin-top: 5px;">
                üìÖ ${date} ‚Ä¢ ${event.location || ''}
            </div>
        </div>
        `;
    }).join('');
}

async function deleteEvent(eventId) {
    if (!confirm('Delete this event?')) return;
    
    try {
        await db.collection('events').doc(eventId).delete();
        alert('‚úÖ Event deleted');
        loadEvents();
    } catch (error) {
        console.error('‚ùå Error deleting event:', error);
        alert('Failed: ' + error.message);
    }
}

// ========== BRAND FUNCTIONS ==========
async function addBrand() {
    console.log('üè™ Add Brand clicked');
    
    if (!db) {
        alert('Database not ready yet. Wait for Firebase to load.');
        return;
    }
    
    const name = document.getElementById('brand-name').value.trim();
    if (!name) {
        alert('Please enter brand name');
        return;
    }
    
    try {
        const brandData = {
            name: name,
            category: document.getElementById('brand-category').value || 'general',
            price: document.getElementById('brand-price').value.trim() || '',
            location: document.getElementById('brand-location').value.trim() || '',
            phone: document.getElementById('brand-phone').value.trim() || '',
            description: document.getElementById('brand-description').value.trim() || '',
            expiry: document.getElementById('brand-expiry').value || null,
            featured: document.getElementById('brand-featured').checked || false,
            image: document.getElementById('brand-image').value.trim() || null,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        console.log('üì§ Saving brand to Firestore:', brandData);
        
        await db.collection('brands').add(brandData);
        
        alert('‚úÖ Brand added successfully!');
        
        clearBrandForm();
        loadBrands();
        switchTab('dashboard');
        
    } catch (error) {
        console.error('‚ùå Error adding brand:', error);
        alert('Failed: ' + error.message);
    }
}

async function loadBrands() {
    if (!db) {
        console.log('Database not ready yet');
        return;
    }
    
    try {
        const snapshot = await db.collection('brands')
            .orderBy('createdAt', 'desc')
            .get();
        
        const brands = [];
        snapshot.forEach(doc => {
            brands.push({
                id: doc.id,
                ...doc.data()
            });
        });
        
        console.log('üìä Loaded', brands.length, 'brands');
        
        // Update counters
        document.getElementById('total-brands').textContent = brands.length;
        document.getElementById('stat-active-brands').textContent = brands.length;
        
        // Display brands
        displayBrands(brands);
        displayDashboardBrands(brands);
        
    } catch (error) {
        console.error('‚ùå Error loading brands:', error);
    }
}

function displayBrands(brands) {
    const container = document.getElementById('brands-container');
    if (!container) return;
    
    if (!brands || brands.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No brands yet. Add your first brand!</p></div>';
        return;
    }
    
    container.innerHTML = brands.map(brand => {
        return `
        <div class="brand-card">
            <div class="brand-image">
                ${brand.image ? 
                    `<img src="${brand.image}" alt="${brand.name}">` : 
                    `<div class="image-placeholder">üè¢</div>`
                }
            </div>
            <div class="brand-content">
                <div class="brand-name">${brand.name}</div>
                ${brand.category ? `<div class="brand-category">${brand.category}</div>` : ''}
                ${brand.price ? `<div class="brand-price">${brand.price}</div>` : ''}
                <div class="brand-info">${brand.description || 'No description'}</div>
                <div class="brand-contact">
                    ${brand.location ? `<div class="brand-location">üìç ${brand.location}</div>` : ''}
                    ${brand.phone ? `<div class="brand-phone">üìû ${brand.phone}</div>` : ''}
                </div>
            </div>
        </div>
        `;
    }).join('');
}

function displayDashboardBrands(brands) {
    const container = document.getElementById('dashboard-brands');
    if (!container) return;
    
    const recentBrands = brands.slice(0, 3);
    
    if (recentBrands.length === 0) {
        container.innerHTML = '<p style="color: #666;">No brands yet</p>';
        return;
    }
    
    container.innerHTML = recentBrands.map(brand => {
        return `
        <div style="padding: 15px; border-bottom: 1px solid #eee; margin-bottom: 10px;">
            <div style="font-weight: bold; color: #333;">${brand.name}</div>
            <div style="color: #666; font-size: 14px; margin-top: 5px;">
                ${brand.category ? `${brand.category} ‚Ä¢ ` : ''}
                ${brand.location || ''}
            </div>
        </div>
        `;
    }).join('');
}

async function deleteBrand(brandId) {
    if (!confirm('Delete this brand?')) return;
    
    try {
        await db.collection('brands').doc(brandId).delete();
        alert('‚úÖ Brand deleted');
        loadBrands();
    } catch (error) {
        console.error('‚ùå Error deleting brand:', error);
        alert('Failed: ' + error.message);
    }
}

// ========== HELPER FUNCTIONS ==========
function clearEventForm() {
    document.getElementById('event-title').value = '';
    document.getElementById('event-date').value = '';
    document.getElementById('event-type').value = '';
    document.getElementById('event-location').value = '';
    document.getElementById('event-time').value = '';
    document.getElementById('event-image').value = '';
    document.getElementById('event-description').value = '';
    document.getElementById('event-button').value = '';
}

function clearBrandForm() {
    document.getElementById('brand-name').value = '';
    document.getElementById('brand-category').value = '';
    document.getElementById('brand-price').value = '';
    document.getElementById('brand-phone').value = '';
    document.getElementById('brand-location').value = '';
    document.getElementById('brand-image').value = '';
    document.getElementById('brand-description').value = '';
    document.getElementById('brand-expiry').value = '';
    document.getElementById('brand-featured').checked = false;
}

function switchTab(tabId) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab
    const tab = document.getElementById(tabId);
    if (tab) tab.classList.add('active');
    
    // Update buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Find and activate clicked button
    document.querySelectorAll('.tab-btn').forEach(btn => {
        if (btn.textContent.toLowerCase().includes(tabId.replace('-', ' '))) {
            btn.classList.add('active');
        }
    });
    
    // Load data for certain tabs
    if (tabId === 'dashboard') {
        loadEvents();
        loadBrands();
    } else if (tabId === 'manage-events') {
        loadEvents();
    } else if (tabId === 'manage-brands') {
        loadBrands();
    }
}

// Make functions global
window.addEvent = addEvent;
window.addBrand = addBrand;
window.switchTab = switchTab;
window.clearEventForm = clearEventForm;
window.clearBrandForm = clearBrandForm;
window.deleteEvent = deleteEvent;
window.deleteBrand = deleteBrand;

console.log('‚úÖ Admin panel code loaded');
</script>
</body>
</html>